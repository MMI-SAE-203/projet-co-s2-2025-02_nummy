---
import { oneIDRecette } from "../../../pocketbase/backend.mjs";
import Layout from "../../layouts/Layout.astro";
import Card from "../../components/Card.astro";
import ImagePB from "../../components/ImagePB.astro";
import Clock from "../../assets/icones/clock.svg";
import Nb_personnes from "../../assets/icones/nb_personnes.svg";
import Star from "../../assets/icones/star.svg";
import Bin from "../../assets/icones/bin.svg";
import { commentaires } from "../../../pocketbase/backend.mjs";

const starCount = 5;

/*Affichage du détail d’un élément de la collection en utilisant une route dynamique.   recette */

const { id } = Astro.params;
const recette = await oneIDRecette(id);
if (!recette) {
    return Astro.redirect("/recette");
}

let recettes = [];
---

<Layout titre={recette.nom_recette}>
    <div>
        <ul class="p-8 p-4 border-2 border-gray-300 rounded-lg shadow-md">
            <li class="p-4 list-none">
                <ImagePB
                    record={recette}
                    field="images_recette"
                    alt={recette.imgAlt}
                    classPicture="flex justify-center"
                    classImg="w-100 h-75 m-2 object-cover rounded-md mx-auto  "
                />
                <span
                    >{recette.continent_recette} | <span
                        >{recette.pays_recette}</span
                    ></span
                >
            </li>

            <li class="p-4">
                <span>{recette.nom_recette}</span>
            </li>

            <ImagePB
                record={recette}
                field="hero_recette"
                alt={recette.imgAlt}
                classPicture="flex "
                classImg="w-50  m-10 rounded-lg"
            />
            <li class="justify-left">
                <Star />
                <li>
                    <Bin />
                    <li class="p-4"><Clock /></li>
                    <li class="p-4">
                        <span>{recette.temps_recette}</span>
                    </li>

                    <li class="p-5"><Nb_personnes /></li>
                    <li class="pt-8">
                        <span>{recette.personnes_recette} personnes</span>
                    </li>

                    <li class="p-4">
                        <p class=""><strong>Ingrédients :</strong></p>
                        <div
                            class="m-5"
                            set:html={recette.ingredients_recette}
                        />
                    </li>

                    <li class="p-4">
                        <p class=""><strong>Préparation :</strong></p>
                        <div
                            class="m-5"
                            set:html={recette.preparation_recette}
                        />
                    </li>
                </li>

                <div
                    class="flex justify-center list-none flex-wrap gap-5 pt- 15 pb-40"
                >
                    <h3 class="p-4 lg:*:justify-center">
                        Découvrez d’autres recettes
                    </h3>
                    <h2 class="m-8"></h2>
                    {recettes.map((recette) => <Card {...recette} />)}
                </div>

                <!-- étoile pour donner son avis  -->
                <div>
                    <p class="text-center mb-2">Donnez Votre Avis !</p>
                </div>
                <div class="flex flex-row-reverse justify-center gap-1 mb-8">
                    {
                        Array.from({ length: starCount }, (_, i) => {
                            const rating = starCount - i;
                            return (
                                <Fragment>
                                    <input
                                        id={`rating-${rating}`}
                                        type="radio"
                                        name="rating"
                                        value={rating}
                                        class="peer hidden"
                                    />
                                    <label
                                        for={`rating-${rating}`}
                                        title={`${rating} star${rating > 1 ? "s" : ""}`}
                                        class="cursor-pointer text-gray-300 peer-checked:text-yellow-400 peer-hover:text-yellow-300 transition-colors duration-150"
                                    >
                                        <svg
                                            viewBox="0 0 576 512"
                                            class="h-6 w-6 fill-current"
                                        >
                                            <path
                                                d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 
              51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 
              113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 
              128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 
              329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 
              150.3 316.9 18z"
                                            />
                                        </svg>
                                    </label>
                                </Fragment>
                            );
                        })
                    }
                </div>
            </li>
        </ul>

        <div class="flex flex-col items-center m-5">
            <label
                for="continent_recette"
                class="font-semibold text-black uppercase"></label>
            <input
                type="text"
                placeholder="PARTAGEZ-NOUS VOTRE OPINION..."
                required
                class="w-105 mt-2 p-2 rounded-md bg-gray-200 justify-center items-center"
            />
        </div>

        <div class="flex justify-center lg:justify-center">
            <a
                href="/"
                class="inline-block bg-[var(--color-orange)] text-black font-semibold py-2 px-4 rounded-3xl mb-6"
            >
                ENVOYER
            </a>
        </div>

        <h3 class="p-4">Commentaires & avis (...)</h3>

        <div class="flex justify-center lg:justify-center">
            <a
                href="/"
                class="inline-block bg-[var(--color-lin)] text-black font-semibold py-2 px-4 rounded-3xl mb-6"
            >
                VOIR PLUS
            </a>
        </div>
    </div></Layout
>
